<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Indexed Families - Functional Programming in Lean</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../custom.css">
        <link rel="stylesheet" href="../pygments.css">
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../title.html">Functional Programming in Lean</a></li><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="../getting-to-know.html"><strong aria-hidden="true">1.</strong> Getting to Know Lean</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting-to-know/evaluating.html"><strong aria-hidden="true">1.1.</strong> Evaluating Expressions</a></li><li class="chapter-item expanded "><a href="../getting-to-know/types.html"><strong aria-hidden="true">1.2.</strong> Types</a></li><li class="chapter-item expanded "><a href="../getting-to-know/functions-and-definitions.html"><strong aria-hidden="true">1.3.</strong> Functions and Definitions</a></li><li class="chapter-item expanded "><a href="../getting-to-know/structures.html"><strong aria-hidden="true">1.4.</strong> Structures</a></li><li class="chapter-item expanded "><a href="../getting-to-know/datatypes-and-patterns.html"><strong aria-hidden="true">1.5.</strong> Datatypes, Patterns and Recursion</a></li><li class="chapter-item expanded "><a href="../getting-to-know/polymorphism.html"><strong aria-hidden="true">1.6.</strong> Polymorphism</a></li><li class="chapter-item expanded "><a href="../getting-to-know/conveniences.html"><strong aria-hidden="true">1.7.</strong> Additional Conveniences</a></li><li class="chapter-item expanded "><a href="../getting-to-know/summary.html"><strong aria-hidden="true">1.8.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><a href="../hello-world.html"><strong aria-hidden="true">2.</strong> Hello, World!</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../hello-world/running-a-program.html"><strong aria-hidden="true">2.1.</strong> Running a Program</a></li><li class="chapter-item expanded "><a href="../hello-world/step-by-step.html"><strong aria-hidden="true">2.2.</strong> Step By Step</a></li><li class="chapter-item expanded "><a href="../hello-world/starting-a-project.html"><strong aria-hidden="true">2.3.</strong> Starting a Project</a></li><li class="chapter-item expanded "><a href="../hello-world/cat.html"><strong aria-hidden="true">2.4.</strong> Worked Example: cat</a></li><li class="chapter-item expanded "><a href="../hello-world/conveniences.html"><strong aria-hidden="true">2.5.</strong> Additional Conveniences</a></li><li class="chapter-item expanded "><a href="../hello-world/summary.html"><strong aria-hidden="true">2.6.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><a href="../props-proofs-indexing.html"><strong aria-hidden="true">3.</strong> Interlude: Propositions, Proofs, and Indexing</a></li><li class="chapter-item expanded "><a href="../type-classes.html"><strong aria-hidden="true">4.</strong> Overloading and Type Classes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../type-classes/pos.html"><strong aria-hidden="true">4.1.</strong> Positive Numbers</a></li><li class="chapter-item expanded "><a href="../type-classes/polymorphism.html"><strong aria-hidden="true">4.2.</strong> Type Classes and Polymorphism</a></li><li class="chapter-item expanded "><a href="../type-classes/out-params.html"><strong aria-hidden="true">4.3.</strong> Controlling Instance Search</a></li><li class="chapter-item expanded "><a href="../type-classes/indexing.html"><strong aria-hidden="true">4.4.</strong> Arrays and Indexing</a></li><li class="chapter-item expanded "><a href="../type-classes/standard-classes.html"><strong aria-hidden="true">4.5.</strong> Standard Classes</a></li><li class="chapter-item expanded "><a href="../type-classes/coercion.html"><strong aria-hidden="true">4.6.</strong> Coercions</a></li><li class="chapter-item expanded "><a href="../type-classes/conveniences.html"><strong aria-hidden="true">4.7.</strong> Additional Conveniences</a></li><li class="chapter-item expanded "><a href="../type-classes/summary.html"><strong aria-hidden="true">4.8.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><a href="../monads.html"><strong aria-hidden="true">5.</strong> Monads</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../monads/class.html"><strong aria-hidden="true">5.1.</strong> The Monad Type Class</a></li><li class="chapter-item expanded "><a href="../monads/arithmetic.html"><strong aria-hidden="true">5.2.</strong> Example: Arithmetic in Monads</a></li><li class="chapter-item expanded "><a href="../monads/do.html"><strong aria-hidden="true">5.3.</strong> do-Notation for Monads</a></li><li class="chapter-item expanded "><a href="../monads/io.html"><strong aria-hidden="true">5.4.</strong> The IO Monad</a></li><li class="chapter-item expanded "><a href="../monads/conveniences.html"><strong aria-hidden="true">5.5.</strong> Additional Conveniences</a></li><li class="chapter-item expanded "><a href="../monads/summary.html"><strong aria-hidden="true">5.6.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><a href="../functor-applicative-monad.html"><strong aria-hidden="true">6.</strong> Functors, Applicative Functors, and Monads</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../functor-applicative-monad/inheritance.html"><strong aria-hidden="true">6.1.</strong> Structures and Inheritance</a></li><li class="chapter-item expanded "><a href="../functor-applicative-monad/applicative.html"><strong aria-hidden="true">6.2.</strong> Applicative Functors</a></li><li class="chapter-item expanded "><a href="../functor-applicative-monad/applicative-contract.html"><strong aria-hidden="true">6.3.</strong> The Applicative Contract</a></li><li class="chapter-item expanded "><a href="../functor-applicative-monad/alternative.html"><strong aria-hidden="true">6.4.</strong> Alternatives</a></li><li class="chapter-item expanded "><a href="../functor-applicative-monad/universes.html"><strong aria-hidden="true">6.5.</strong> Universes</a></li><li class="chapter-item expanded "><a href="../functor-applicative-monad/complete.html"><strong aria-hidden="true">6.6.</strong> The Complete Definitions</a></li><li class="chapter-item expanded "><a href="../functor-applicative-monad/summary.html"><strong aria-hidden="true">6.7.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><a href="../monad-transformers.html"><strong aria-hidden="true">7.</strong> Monad Transformers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../monad-transformers/reader-io.html"><strong aria-hidden="true">7.1.</strong> Combining IO and Reader</a></li><li class="chapter-item expanded "><a href="../monad-transformers/transformers.html"><strong aria-hidden="true">7.2.</strong> A Monad Construction Kit</a></li><li class="chapter-item expanded "><a href="../monad-transformers/order.html"><strong aria-hidden="true">7.3.</strong> Ordering Monad Transformers</a></li><li class="chapter-item expanded "><a href="../monad-transformers/do.html"><strong aria-hidden="true">7.4.</strong> More do Features</a></li><li class="chapter-item expanded "><a href="../monad-transformers/conveniences.html"><strong aria-hidden="true">7.5.</strong> Additional Conveniences</a></li><li class="chapter-item expanded "><a href="../monad-transformers/summary.html"><strong aria-hidden="true">7.6.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><a href="../dependent-types.html"><strong aria-hidden="true">8.</strong> Programming with Dependent Types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../dependent-types/indexed-families.html" class="active"><strong aria-hidden="true">8.1.</strong> Indexed Families</a></li><li class="chapter-item expanded "><a href="../dependent-types/universe-pattern.html"><strong aria-hidden="true">8.2.</strong> The Universe Design Pattern</a></li><li class="chapter-item expanded "><a href="../dependent-types/typed-queries.html"><strong aria-hidden="true">8.3.</strong> Worked Example: Typed Queries</a></li><li class="chapter-item expanded "><a href="../dependent-types/indices-parameters-universes.html"><strong aria-hidden="true">8.4.</strong> Indices, Parameters, and Universe Levels</a></li><li class="chapter-item expanded "><a href="../dependent-types/pitfalls.html"><strong aria-hidden="true">8.5.</strong> Pitfalls of Programming with Dependent Types</a></li><li class="chapter-item expanded "><a href="../dependent-types/summary.html"><strong aria-hidden="true">8.6.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.</strong> Interlude: Tactics, Induction, and Proofs</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.</strong> From Programming to Proving</div></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Functional Programming in Lean</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="indexed-families"><a class="header" href="#indexed-families">Indexed Families</a></h1>
<p>Polymorphic inductive types take type arguments.
For instance, <code>List</code> takes an argument that determines the type of the entries in the list, and <code>Except</code> takes arguments that determine the types of the exceptions or values.
These type arguments, which are the same in every constructor of the datatype, are referred to as <em>parameters</em>.</p>
<p>Arguments to inductive types need not be the same in every constructor, however.
Inductive types in which the arguments to the type vary based on the choice of constructor are called <em>indexed families</em>, and the arguments that vary are referred to as <em>indices</em>.
The &quot;hello world&quot; of indexed families is a type of lists that contains the length of the list in addition to the type of entries, conventionally referred to as &quot;vectors&quot;:</p>
<pre><code class="language-lean">inductive Vect (α : Type u) : Nat → Type u where
   | nil : Vect α 0
   | cons : α → Vect α n → Vect α (n + 1)
</code></pre>
<p>Function declarations may take some arguments before the colon, indicating that they are available in the entire definition, and some arguments after, indicating a desire to pattern-match on them and define the function case by case.
Inductive datatypes have a similar principle: the argument <code>α</code> is named at the top of the datatype declaration, prior to the colon, which indicates that it is a parameter that must be provided as the first argument in all occurrences of <code>Vect</code> in the definition, while the <code>Nat</code> argument occurs after the colon, indicating that it is an index that may vary.
Indeed, the three occurrences of <code>Vect</code> in the <code>nil</code> and <code>cons</code> constructor declarations consistently provide <code>α</code> as the first argument, while the second argument is different in each case.</p>
<p>The declaration of <code>nil</code> states that it is a constructor of type <code>Vect α 0</code>.
This means that using <code>Vect.nil</code> in a context expecting a <code>Vect String 3</code> is a type error, just as <code>[1, 2, 3]</code> is a type error in a context that expects a <code>List String</code>:</p>
<pre><code class="language-lean">example : Vect String 3 := Vect.nil
</code></pre>
<pre><code class="language-output error">type mismatch
  Vect.nil
has type
  Vect String 0 : Type
but is expected to have type
  Vect String 3 : Type
</code></pre>
<p>The mismatch between <code>0</code> and <code>3</code> in this example plays exactly the same role as any other type mismatch, even though <code>0</code> and <code>3</code> are not themselves types.</p>
<p>Indexed families are called <em>families</em> of types because different index values can make different constructors available for use.
In some sense, an indexed family is not a type; rather, it is a collection of related types, and the choice of index values also chooses a type from the collection.
Choosing the index <code>5</code> for <code>Vect</code> means that only the constructor <code>cons</code> is available, and choosing the index <code>0</code> means that only <code>nil</code> is available.</p>
<p>If the index is not yet known (e.g. because it is a variable), then no constructor can be used until it becomes known.
Using <code>n</code> for the length allows neither <code>Vect.nil</code> nor <code>Vect.cons</code>, because there's no way to know whether the variable <code>n</code> should stand for a <code>Nat</code> that matches <code>0</code> or <code>n + 1</code>:</p>
<pre><code class="language-lean">example : Vect String n := Vect.nil
</code></pre>
<pre><code class="language-output error">type mismatch
  Vect.nil
has type
  Vect String 0 : Type
but is expected to have type
  Vect String n : Type
</code></pre>
<pre><code class="language-lean">example : Vect String n := Vect.cons &quot;Hello&quot; (Vect.cons &quot;world&quot; Vect.nil)
</code></pre>
<pre><code class="language-output error">type mismatch
  Vect.cons &quot;Hello&quot; (Vect.cons &quot;world&quot; Vect.nil)
has type
  Vect String (0 + 1 + 1) : Type
but is expected to have type
  Vect String n : Type
</code></pre>
<p>Having the length of the list as part of its type means that the type becomes more informative.
For example, <code>Vect.replicate</code> is a function that creates a <code>Vect</code> with a number of copies of a given value.
The type that says this precisely is:</p>
<pre><code class="language-lean">def Vect.replicate (n : Nat) (x : α) : Vect α n := _
</code></pre>
<p>The argument <code>n</code> appears as the length of the result.
The message associated with the underscore placeholder describes the task at hand:</p>
<pre><code class="language-output error">don't know how to synthesize placeholder
context:
α : Type u_1
n : Nat
x : α
⊢ Vect α n
</code></pre>
<p>When working with indexed families, constructors can only be applied when Lean can see that the constructor's index matches the index in the expected type.
However, neither constructor has an index that matches <code>n</code>—<code>nil</code> matches <code>Nat.zero</code>, and <code>cons</code> matches <code>Nat.succ</code>.
Just as in the example type errors, the variable <code>n</code> could stand for either, depending on which <code>Nat</code> is provided to the function as an argument.
The solution is to use pattern matching to consider both of the possible cases:</p>
<pre><code class="language-lean">def Vect.replicate (n : Nat) (x : α) : Vect α n :=
  match n with
  | 0 =&gt; _
  | k + 1 =&gt; _
</code></pre>
<p>Because <code>n</code> occurs in the expected type, pattern matching on <code>n</code> <em>refines</em> the expected type in the two cases of the match.
In the first underscore, the expected type has become <code>Vect α 0</code>:</p>
<pre><code class="language-output error">don't know how to synthesize placeholder
context:
α : Type u_1
n : Nat
x : α
⊢ Vect α 0
</code></pre>
<p>In the second underscore, it has become <code>Vect α (k + 1)</code>:</p>
<pre><code class="language-output error">don't know how to synthesize placeholder
context:
α : Type u_1
n : Nat
x : α
k : Nat
⊢ Vect α (k + 1)
</code></pre>
<p>When pattern matching refines the type of a program in addition to discovering the structure of a value, it is called <em>dependent pattern matching</em>.</p>
<p>The refined type makes it possible to apply the constructors.
The first underscore matches <code>Vect.nil</code>, and the second matches <code>Vect.cons</code>: </p>
<pre><code class="language-lean">def Vect.replicate (n : Nat) (x : α) : Vect α n :=
  match n with
  | 0 =&gt; .nil
  | k + 1 =&gt; .cons _ _
</code></pre>
<p>The first underscore under the <code>.cons</code> should have type <code>α</code>.
There is an <code>α</code> available, namely <code>x</code>:</p>
<pre><code class="language-output error">don't know how to synthesize placeholder
context:
α : Type u_1
n : Nat
x : α
k : Nat
⊢ α
</code></pre>
<p>The second underscore should be a <code>Vect α k</code>, which can be produced by a recursive call to <code>replicate</code>:</p>
<pre><code class="language-output error">don't know how to synthesize placeholder
context:
α : Type u_1
n : Nat
x : α
k : Nat
⊢ Vect α k
</code></pre>
<p>Here is the final definition of <code>replicate</code>:</p>
<pre><code class="language-lean">def Vect.replicate (n : Nat) (x : α) : Vect α n :=
  match n with
  | 0 =&gt; .nil
  | k + 1 =&gt; .cons x (replicate k x)
</code></pre>
<p>In addition to providing assistance while writing the function, the informative type of <code>Vect.replicate</code> also allows client code to rule out a number of unexpected functions without having to read the source code.
A version of <code>replicate</code> for lists could produce a list of the wrong length:</p>
<pre><code class="language-lean">def List.replicate (n : Nat) (x : α) : List α :=
  match n with
  | 0 =&gt; []
  | k + 1 =&gt; x :: x :: replicate k x
</code></pre>
<p>However, making this mistake with <code>Vect.replicate</code> is a type error:</p>
<pre><code class="language-lean">def Vect.replicate (n : Nat) (x : α) : Vect α n :=
  match n with
  | 0 =&gt; .nil
  | k + 1 =&gt; .cons x (.cons x (replicate k x))
</code></pre>
<pre><code class="language-output error">application type mismatch
  cons x (cons x (replicate k x))
argument
  cons x (replicate k x)
has type
  Vect α (k + 1) : Type ?u.2004
but is expected to have type
  Vect α k : Type ?u.2004
</code></pre>
<p>The function <code>List.zip</code> combines two lists by pairing the first entry in the first list with the first entry in the second list, the second entry in the first list with the second entry in the second list, and so forth.
<code>List.zip</code> can be used to pair the three highest peaks in the US state of Oregon with the three highest peaks in Denmark:</p>
<pre><code class="language-lean">[&quot;Mount Hood&quot;,
 &quot;Mount Jefferson&quot;,
 &quot;South Sister&quot;].zip [&quot;Møllehøj&quot;, &quot;Yding Skovhøj&quot;, &quot;Ejer Bavnehøj&quot;]
</code></pre>
<p>The result is a list of three pairs:</p>
<pre><code class="language-lean">[(&quot;Mount Hood&quot;, &quot;Møllehøj&quot;),
 (&quot;Mount Jefferson&quot;, &quot;Yding Skovhøj&quot;),
 (&quot;South Sister&quot;, &quot;Ejer Bavnehøj&quot;)]
</code></pre>
<p>It's somewhat unclear what should happen when the lists have different lengths.
Like many languages, Lean chooses to ignore the extra entries in one of the lists.
For instance, combining the heights of the five highest peaks in Oregon with those of the three highest peaks in Denmark yields three pairs.
In particular,</p>
<pre><code class="language-lean">[3428.8, 3201, 3158.5, 3075, 3064].zip [170.86, 170.77, 170.35]
</code></pre>
<p>evaluates to</p>
<pre><code class="language-lean">[(3428.8, 170.86), (3201, 170.77), (3158.5, 170.35)]
</code></pre>
<p>While this approach is convenient because it always returns an answer, it runs the risk of throwing away data when the lists unintentionally have different lengths.
F# takes a different approach: its version of <code>List.zip</code> throws an exception when the lengths don't match, as can be seen in this <code>fsi</code> session:</p>
<pre><code class="language-fsharp">&gt; List.zip [3428.8; 3201.0; 3158.5; 3075.0; 3064.0] [170.86; 170.77; 170.35];;
</code></pre>
<pre><code class="language-output error">System.ArgumentException: The lists had different lengths.
list2 is 2 elements shorter than list1 (Parameter 'list2')
   at Microsoft.FSharp.Core.DetailedExceptions.invalidArgDifferentListLength[?](String arg1, String arg2, Int32 diff) in /builddir/build/BUILD/dotnet-v3.1.424-SDK/src/fsharp.3ef6f0b514198c0bfa6c2c09fefe41a740b024d5/src/fsharp/FSharp.Core/local.fs:line 24
   at Microsoft.FSharp.Primitives.Basics.List.zipToFreshConsTail[a,b](FSharpList`1 cons, FSharpList`1 xs1, FSharpList`1 xs2) in /builddir/build/BUILD/dotnet-v3.1.424-SDK/src/fsharp.3ef6f0b514198c0bfa6c2c09fefe41a740b024d5/src/fsharp/FSharp.Core/local.fs:line 918
   at Microsoft.FSharp.Primitives.Basics.List.zip[T1,T2](FSharpList`1 xs1, FSharpList`1 xs2) in /builddir/build/BUILD/dotnet-v3.1.424-SDK/src/fsharp.3ef6f0b514198c0bfa6c2c09fefe41a740b024d5/src/fsharp/FSharp.Core/local.fs:line 929
   at Microsoft.FSharp.Collections.ListModule.Zip[T1,T2](FSharpList`1 list1, FSharpList`1 list2) in /builddir/build/BUILD/dotnet-v3.1.424-SDK/src/fsharp.3ef6f0b514198c0bfa6c2c09fefe41a740b024d5/src/fsharp/FSharp.Core/list.fs:line 466
   at &lt;StartupCode$FSI_0006&gt;.$FSI_0006.main@()
Stopped due to error
</code></pre>
<p>This avoids accidentally discarding information, but crashing a program comes with its own difficulties.
The Lean equivalent, which would use the <code>Option</code> or <code>Except</code> monads, would introduce a burden that may not be worth the safety.</p>
<p>Using <code>Vect</code>, however, it is possible to write a version of <code>zip</code> with a type that requires that both arguments have the same length:</p>
<pre><code class="language-lean">def Vect.zip : Vect α n → Vect β n → Vect (α × β) n
  | .nil, .nil =&gt; .nil
  | .cons x xs, .cons y ys =&gt; .cons (x, y) (zip xs ys)
</code></pre>
<p>This definition only has patterns for the cases where either both arguments are <code>Vect.nil</code> or both arguments are <code>Vect.cons</code>, and Lean accepts the definition without a &quot;missing cases&quot; error like the one that results from a similar definition for <code>List</code>:</p>
<pre><code class="language-lean">def List.zip : List α → List β → List (α × β)
  | [], [] =&gt; []
  | x :: xs, y :: ys =&gt; (x, y) :: zip xs ys
</code></pre>
<pre><code class="language-output error">missing cases:
(List.cons _ _), []
[], (List.cons _ _)
</code></pre>
<p>This is because the constructor used in the first pattern, <code>nil</code> or <code>cons</code>, <em>refines</em> the type checker's knowledge about the length <code>n</code>.
When the first pattern is <code>nil</code>, the type checker can additionally determine that the length was <code>0</code>, so the only possible choice for the second pattern is <code>nil</code>.
Similarly, when the first pattern is <code>cons</code>, the type checker can determine that the length was <code>k+1</code> for some <code>Nat</code> <code>k</code>, so the only possible choice for the second pattern is <code>cons</code>.
Indeed, adding a case that uses <code>nil</code> and <code>cons</code> together is a type error, because the lengths don't match:</p>
<pre><code class="language-lean">def Vect.zip : Vect α n → Vect β n → Vect (α × β) n
  | .nil, .nil =&gt; .nil
  | .nil, .cons y ys =&gt; .nil
  | .cons x xs, .cons y ys =&gt; .cons (x, y) (zip xs ys)
</code></pre>
<pre><code class="language-output error">type mismatch
  Vect.cons y ys
has type
  Vect β (?m.4750 + 1) : Type ?u.4562
but is expected to have type
  Vect β 0 : Type ?u.4562
</code></pre>
<p>The refinement of the length can be observed by making <code>n</code> into an explicit argument:</p>
<pre><code class="language-lean">def Vect.zip : (n : Nat) → Vect α n → Vect β n → Vect (α × β) n
  | 0, .nil, .nil =&gt; .nil
  | k + 1, .cons x xs, .cons y ys =&gt; .cons (x, y) (zip k xs ys)
</code></pre>
<h2 id="exercises"><a class="header" href="#exercises">Exercises</a></h2>
<p>Getting a feel for programming with dependent types requires experience, and the exercises in this section are very important.
For each exercise, try to see which mistakes the type checker can catch, and which ones it can't, by experimenting with the code as you go.
This is also a good way to develop a feel for the error messages.</p>
<ul>
<li>
<p>Double-check that <code>Vect.zip</code> gives the right answer when combining the three highest peaks in Oregon with the three highest peaks in Denmark.
Because <code>Vect</code> doesn't have the syntactic sugar that <code>List</code> has, it can be helpful to begin by defining <code>oregonianPeaks : Vect String 3</code> and <code>danishPeaks : Vect String 3</code>.</p>
</li>
<li>
<p>Define a function <code>Vect.map</code> with type <code>(α → β) → Vect α n → Vect β n</code>.</p>
</li>
<li>
<p>Define a function <code>Vect.zipWith</code> that combines the entries in a <code>Vect</code> one at a time with a function.
It should have the type <code>(α → β → γ) → Vect α n → Vect β n → Vect γ n</code>.</p>
</li>
<li>
<p>Define a function <code>Vect.unzip</code> that splits a <code>Vect</code> of pairs into a pair of <code>Vect</code>s. It should have the type <code>Vect (α × β) n → Vect α n × Vect β n</code>.</p>
</li>
<li>
<p>Define a function <code>Vect.snoc</code> that adds an entry to the <em>end</em> of a <code>Vect</code>. Its type should be <code>Vect α n → α → Vect α (n + 1)</code> and <code>#eval Vect.snoc (.cons &quot;snowy&quot; .nil) &quot;peaks&quot;</code> should yield <code>Vect.cons &quot;snowy&quot; (Vect.cons &quot;peaks&quot; (Vect.nil))</code>. The name <code>snoc</code> is a traditional functional programming pun: it is <code>cons</code> backwards.</p>
</li>
<li>
<p>Define a function <code>Vect.reverse</code> that reverses the order of a <code>Vect</code>.</p>
</li>
<li>
<p>Define a function <code>Vect.drop</code> with the following type: <code>(n : Nat) → Vect α (k + n) → Vect α k</code>.
Verify that it works by checking that <code>#eval danishPeaks.drop 2</code> yields <code>Vect.cons &quot;Ejer Bavnehøj&quot; (Vect.nil)</code>.</p>
</li>
<li>
<p>Define a function <code>Vect.take</code> with type <code>(n : Nat) → Vect α (k + n) → Vect α n</code> that returns the first <code>n</code> entries in the <code>Vect</code>. Check that it works on an example.</p>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../dependent-types.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../dependent-types/universe-pattern.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../dependent-types.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../dependent-types/universe-pattern.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
